<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>table模块快速使用</title>
    <!--引入资源文件-->
    <link rel="stylesheet" href="../staticResourceFile/layui/css/layui.css" media="all">
</head>
<body>
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
        <button class="layui-btn layui-btn-sm" lay-event="remove">验证是否全选</button>
    </div>
</script>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    <legend>方框风格的表单集合(搜索区域)</legend>
</fieldset>
<form class="layui-form layui-form-pane" action="" lay-filter="form_search_data">
    <div class="layui-form-item">
        <label class="layui-form-label">长输入框</label>
        <div class="layui-input-block">
            <input type="text" name="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">日期选择</label>
            <div class="layui-input-block">
                <input type="text" name="date" id="date1" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">行内表单</label>
            <div class="layui-input-inline">
                <input type="text" name="number" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline">
                <input type="text" name="number" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">请务必填写用户名</div>
        </div>

    </div>


    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">范围</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid">-</div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="price_max" placeholder="￥" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">单行选择框</label>
        <div class="layui-input-block">
            <select name="interest" lay-filter="aihao">
                <option value=""></option>
                <option value="0">写作</option>
                <option value="1" selected="">阅读</option>
                <option value="2">游戏</option>
                <option value="3">音乐</option>
                <option value="4">旅行</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">行内选择框</label>
        <div class="layui-input-inline">
            <select name="quiz1">
                <option value="">请选择省</option>
                <option value="浙江" selected="">浙江省</option>
                <option value="你的工号">江西省</option>
                <option value="你最喜欢的老师">福建省</option>
            </select>
        </div>
        <div class="layui-input-inline">
            <select name="quiz2">
                <option value="">请选择市</option>
                <option value="杭州">杭州</option>
                <option value="宁波" disabled="">宁波</option>
                <option value="温州">温州</option>
                <option value="温州">台州</option>
                <option value="温州">绍兴</option>
            </select>
        </div>
        <div class="layui-input-inline">
            <select name="quiz3">
                <option value="">请选择县/区</option>
                <option value="西湖区">西湖区</option>
                <option value="余杭区">余杭区</option>
                <option value="拱墅区">临安市</option>
            </select>
        </div>
    </div>
    <div class="layui-row">
        <div class="layui-col-md4">
            <div class="layui-form-item" pane="">
                <label class="layui-form-label">单选框</label>
                <div class="layui-input-block">
                    <input type="radio" name="sex" value="男" title="男" checked="">
                    <input type="radio" name="sex" value="女" title="女">
                    <input type="radio" name="sex" value="禁" title="禁用" disabled="">
                </div>
            </div>
        </div>
    </div>
</form>
<div class="layui-btn-container"><!--lay-active="e1"  中的e1 ,e2 ,e3可以自定义-->
    <button type="button" class="layui-btn" lay-active="e1" value="1">按钮一</button>
    <button type="button" class="layui-btn" lay-active="e2" value="2">按钮二</button>
    <button type="button" class="layui-btn" lay-active="e3" value="3">按钮三</button>
</div>
<!--数据新增和编辑表单页面-->
<form class="layui-form" action="" lay-filter="form_data" id="form_data" style="display: none">
    <div class="layui-form-item">
        <label class="layui-form-label">输入框</label>
        <div class="layui-input-block">
            <input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">密码框</label>
        <div class="layui-input-inline">
            <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off"
                   class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">辅助文字</div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">选择框</label>
        <div class="layui-input-block">
            <select name="city" lay-verify="required" id="deptId">

            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">复选框</label>
        <div class="layui-input-block" id="div_checkbox">
            <!--            <input type="checkbox" name="like" title="写作">-->
            <!--            <input type="checkbox" name="like" title="阅读" checked>-->
            <!--            <input type="checkbox" name="like" title="发呆">-->
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">开关</label>
        <div class="layui-input-block">
            <input type="checkbox" name="switch" lay-skin="switch">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">单选框</label>
        <div class="layui-input-block">
            <input type="radio" name="sex" value="男" title="男">
            <input type="radio" name="sex" value="女" title="女" checked>
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">文本域</label>
        <div class="layui-input-block">
            <textarea name="desc" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="form_btn">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>
<!--主列表-->
<table id="table_data" lay-filter="tableData"></table>
<!--引入资源文件-->
<script src="../staticResourceFile/layui/layui.js"></script>
<script type="text/javascript">
    let url = 'http://127.0.0.1:8080/baseTable/findAll';
    layui.use(['table', 'form', 'util', 'jquery'], function () {
        let table = layui.table;
        let util = layui.util;
        let $ = layui.$; //重点处
        let form = layui.form;
        //右下角固定块
        util.fixbar({
            bar1: true
            , bar2: true
            , css: {right: 50, bottom: 100}
            , bgcolor: '#393D49'
            , click: function (type) {
                if (type === 'bar1') {
                    layer.msg('icon 是可以随便换的')
                } else if (type === 'bar2') {
                    layer.msg('两个 bar 都可以设定是否开启')
                }
            }
        });
        //第一个实例
        let table_first = table.render({
            elem: '#table_data'
            , url: url //数据接口
            , method: "POST"
            , contentType: 'application/json'
            , toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
            , page: true //开启分页
            , where: {name: "张三", title: "标题"}/*搜索参数*/
            , defaultToolbar: ['filter', 'exports', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                title: '提示'
                , layEvent: 'LAYTABLE_TIPS'/*按钮事件名称*/
                , icon: 'layui-icon-engine'/*图标*/
            }]
            , request: {
                pageName: 'curr' //页码的参数名称，默认：page
                , limitName: 'nums' //每页数据量的参数名，默认：limit
            }
            // , response: {
            //     statusName: 'code' //规定数据状态的字段名称，默认：code
            //     , statusCode: "1" //规定成功的状态码，默认：0
            //     , msgName: 'msg' //规定状态信息的字段名称，默认：msg
            //     , countName: 'count' //规定数据总数的字段名称，默认：count
            //     , dataName: 'data' //规定数据列表的字段名称，默认：data
            // }
            // response  和 parseData 使用一个就可以了
            , parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": 0, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "data": res.data.list, //解析数据列表
                    "count": res.data.count

                };
            }
            , cols: [[ //表头
                {type: 'checkbox', fixed: 'left'}
                , {field: 'id', title: ' 序号', type: 'numbers'}//序号
                , {field: "id", title: '主键'}
                , {field: 'title', title: '标题'}
                , {field: 'corpusSegmentationSet', title: '分词信息', templet: '#checkboxTem'}//进行数据进行特殊处理
                , {field: 'wealth', title: '操作', toolbar: '#barDemo'}
            ]]
            , done: function (res, curr, count) {
                //接口返回值
                console.log("接口返回值", res);
                //得到当前页码
                console.log("当前页码", curr);
                //得到数据总量
                console.log("数据总量", count);
            }

        });

        //头工具栏事件  tableData  table lay-filter="tableData" 的值
        table.on('toolbar(tableData)', function (obj) {
            debugger;
            //obj.config.id  数据表格的ID
            let checkStatus = table.checkStatus(obj.config.id);
            let data = checkStatus.data;
            switch (obj.event) {
                case 'getCheckData':
                    layer.alert(JSON.stringify(data));
                    break;
                case 'getCheckLength':
                    layer.msg('选中了：' + data.length + ' 个');
                    break;
                case 'isAll':
                    layer.msg(checkStatus.isAll ? '全选' : '未全选');
                    break;
                case 'add':
                    let index = layer.open({
                        type: 1,
                        content: $("#form_data"),
                        area: ['900px', '600px'],
                        maxmin: true,
                        success: function (layero, index) {
                            // var iframe = window['layui-layer-iframe' + index];
                            //调用子页面的全局函数
                            // iframe.child(data)
                            console.log("打开编辑页面")
                            let data = [];
                            let data_1 = {};
                            let data_2 = {};
                            data_1['title'] = '标题1';
                            data_1['id'] = '1';
                            data_2['title'] = '标题2';
                            data_2['id'] = '2';
                            data.push(data_1);
                            data.push(data_2);
                            /*初始化select*/
                            form_select_done('deptId', data, 'title', 'id', 'true');
                            /*选中select指定的值*/
                            form_select_checked("deptId", 2);
                            /*初始化 checkBox*/
                            checkbox_done('div_checkbox', data, 'title', 'id', "checkbox_name", 'false');
                            let values = [1];
                            /*选中指定的checkbox的值*/
                            checkbox_checked('checkbox_name', values);
                        },
                        cancel: function () {
                            // 右上角关闭事件的逻辑
                            // alert("关闭子页面");
                            console.log("关闭子页面")
                        },
                        close: function () {
                            // alert("关闭页面")
                            console.log("关闭页面")
                        },
                        end: function () {
                            // alert("关闭页面-end")
                            console.log("关闭页面-end")
                        }
                    });
//                     layer.full(index);
//                     let form_data = {};
//                     form_data.title = '赋值测试';
//                     form_data.city = '1944';
//                     form.val('form_data', form_data);
//                     //给表单赋值
//                     form.val("form_data", { //form_data 即 class="layui-form" 所在元素属性 lay-filter="" 对应的值
//                         "username": "贤心" // "name": "value"
//                         , "sex": "女"
//                         , "auth": 3
//                         , "check[write]": true
//                         , "open": false
//                         , "desc": "我爱layui"
//                     });
//
//
// //获取表单区域所有值
//                     var data1 = form.val("form_data");

                    break;

                //自定义头工具栏右侧图标 - 提示
                case 'LAYTABLE_TIPS':
                    layer.alert('这是工具栏右侧自定义的一个图标按钮');
                    break;
            }
        });

        //监听工具条  表格行按钮的事件处理
        table.on('tool(tableData)', function (obj) {
            let data = obj.data;
            if (obj.event === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    obj.del();
                    layer.close(index);
                });
            } else if (obj.event === 'edit') {
                console.log("当前表格的数据", JSON.stringify(data));
                //弹出即全屏
                let index = layer.open({
                    type: 1,
                    content: $("#form_data"),
                    area: ['900px', '600px'],
                    maxmin: true,
                    success: function (layero, index) {
                        // var iframe = window['layui-layer-iframe' + index];
                        //调用子页面的全局函数
                        // iframe.child(data)
                    },
                    cancel: function () {
                        // 右上角关闭事件的逻辑
                        // alert("关闭子页面");
                        console.log("关闭子页面")
                    },
                    close: function () {
                        // alert("关闭页面")
                        console.log("关闭页面")
                    },
                    end: function () {
                        // alert("关闭页面-end")
                        console.log("关闭页面-end")
                    }
                });
            }
        });


        //处理属性 为 lay-active 的所有元素事件  lay-active  button 属性
        util.event('lay-active', {
            e1: function () {
                console.log("this", this)
                //获取 class=layui-form lay-filter=XX的表单的数据 此处,form_search_data和 form_data的值
                let form_search_data = form.val("form_search_data");
                let form_data = form.val("form_data");
                console.log("form表单数据form_search_data", form_search_data);
                console.log("form表单数据form_data", form_data);
                alert('触发了事件1');
            }
            , e2: function () {
                // table.reload(ID, options);
                table_first.reload();
                alert('触发了事件2');
            }
            , e3: function () {
                alert('触发了事件3');
            }
        }, 'click');


        /*
        * form 表单提交时在此进行监听
        * form 表单  的lay-submit  lay-filter="form_btn"
        * */
        form.on('submit(form_btn)', function (data) {//submit(form_btn)中的 form_btn 号为事件过滤器的值， <button lay-submit lay-filter="*">提交</button>


            console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
            console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
            console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });


        /**
         * 向容器div_id 中添加select类型的数据
         * @param div_id  容器ID
         * @param data  数组对象
         * @param name name的key
         * @param value value的key
         * @param append true 追加  false清空后重新添加
         * */
        function form_select_done(div_id, data, name, value, append) {
            if ('false' === append) {
                $('#' + div_id).empty();
            }
            $.each(data, function (index, item) {
                $('#' + div_id).append(new Option(item[name], item[value]));
            });
            form.render();
        }

        /**
         * 向容器div_id 选中check_value的值
         * @param div_id  容器ID
         * @param check_value 需要选中的值
         * */
        function form_select_checked(div_id, check_value) {
            $("#" + div_id).find("option[value=" + check_value + "]").attr("selected", true);
        }


        /**
         * 向容器ID为div_id 中添加数据
         * @param div_id 容器ID
         * @param data  数组对象
         * @param name  name的key
         * @param value value的key
         * @param checkboxName checkbox的name值
         * @param append true 追加  false清空后重新添加
         * */
        function checkbox_done(div_id, data, name, value, checkboxName, append) {
            if ('false' === append) {
                $('#' + div_id).empty();
            }
            $.each(data, function (index, item) {
                $("#" + div_id).append("<input type='checkbox' title=" + item[name] + " name=" + checkboxName + " value=" + item[value] + "  />");
            });
            form.render();
        }

        /**
         * 选中checkbox 为 checkbox_name 值为  values的值
         * @param checkbox_name  checkbox的名称
         * @param values checkbox需要选中的值，类型数组
         */
        function checkbox_checked(checkbox_name, values) {
            for (let value of values) {
                $("input[name= " + checkbox_name + "][value=" + value + "]").attr('checked', true);
            }
            form.render();
        }
    });

</script>
<!--行内数据  表单元素   -->
<script id="checkboxTem" type="text/html">
    <form class="layui-form" action="">
        <div class="layui-form-item" pane="">
            <div class="layui-input-block">
                {{# layui.each(d.corpusSegmentationSet, function(index, item){ }}
                <input type="checkbox" {{ item.checked=="1"?'checked':'' }} title="{{ item.segWord }}">
                {{# }); }}
            </div>
        </div>
    </form>
</script>
<!--行级操作按钮-->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
</body>
</html>
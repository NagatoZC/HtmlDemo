<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>table模块快速使用</title>
    <!--引入资源文件-->
    <link rel="stylesheet" href="../staticResourceFile/layui/css/layui.css" media="all">
    <style>
        .atalk {
            margin: 10px;
        }

        .atalk span {
            display: inline-block;
            background: #0181cc;
            border-radius: 10px;
            color: #fff;
            padding: 5px 10px;
            margin: 7px 0 0 45px;
        }

        .atalk i {
            padding-left: 15px;
            font-style: normal;
        }

        .atalk:before {
            content: '';
            position: relative;
            left: 37px;
            top: 52px;
            width: 0;
            height: 0;
            border-style: solid dashed dashed;
            border-color: #0181cc transparent transparent;
            overflow: hidden;
            border-width: 10px;
        }

        .btalk {
            margin: 10px;
            text-align: right;
        }

        .btalk span {
            display: inline-block;
            background: #ef8201;
            border-radius: 10px;
            color: #fff;
            padding: 5px 10px;
            margin: 7px 22px 0 0;
        }

        .btalk i {
            padding-right: 15px;
            font-style: normal;
        }

        .btalk:after {
            content: '';
            position: relative;
            top: 3px;
            width: 0;
            height: 0;
            border-style: solid dashed dashed;
            border-color: #ef8201 transparent transparent;
            overflow: hidden;
            border-width: 10px;
            right: 38px;
        }

        .talkTopDiv {
            color: #999;
        }

        .voerflowClass {
            overflow-y: auto;
        }
    </style>
    <script>
        function close_self() {
            var userAgent = navigator.userAgent;
            if (userAgent.indexOf("Firefox") != -1 || userAgent.indexOf("Chrome") != -1) {
                location.href = "about:blank";
            } else {
                window.opener = null;
                window.open('', '_self');
            }
            window.close();
        }

        //判断分机号存在不存在
        var extNumber = "${extensionNumber}";
        if (extNumber) {

        } else {
            alert("分机号不存在，即将强制退出页面");
            close_self();
        }
    </script>
</head>
<body>
<div class="layui-elem-quote" style="background:radial-gradient(#cec4b7, #48383800)">
    <form class="layui-form layui-form-pane">
        <div class="layui-row">
            <div class="layui-inline">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 80px;">时间：</label>
                    <div class="layui-input-inline">
                        <input id="timer" type="text" disabled class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px;">质检分机号：</label>
                    <div class="layui-input-inline">
                        <input value="${extensionNumber}" type="text" disabled class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-form-item">
                    <label class="layui-form-label">主叫号码：</label>
                    <div class="layui-input-inline">
                        <input id="callingNumber" value="" type="text" disabled class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-form-item">
                    <label class="layui-form-label">被叫号码：</label>
                    <div class="layui-input-inline">
                        <input id="calledNumber" value="" type="text" disabled class="layui-input">
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<div class="layui-collapse">
    <div class="layui-row">
        <fieldset class="layui-elem-field layui-col-md4 layui-col-sm4">
            <legend>【聊天窗口】</legend>
            <div style="height: 5px;background-color: lemonchiffon"></div>
            <div class="layui-field-box voerflowClass" style="height: 80%" id="dialogLeft">

                <div class="btalk">
                    <div class="talkTopDiv"><i>2020年3月31日 16:43:15</i>坐席</div>
                    <span>欢迎拨打智能语音客服，请问有什么可以帮助您的？</span>
                </div>

                <div class="atalk">
                    <div class="talkTopDiv">用户<i>2020年3月31日 16:43:15</i></div>
                    <span>告诉我一下公司地址可以吗？</span>
                </div>

            </div>
        </fieldset>


        <fieldset class="layui-elem-field layui-col-md7 layui-col-sm7" style="margin: 0 30px 0 30px">
            <legend>【话术辅助】</legend>
            <div style="height: 5px;background-color: lemonchiffon"></div>
            <div class="layui-field-box voerflowClass" style="height: 80%" id="dialogLeftVt">

                <div class="btalk">
                    <div class="talkTopDiv"><i>2020年3月31日 16:43:14</i>欢迎语</div>
                    <span>欢迎拨打智能语音客服</span>
                </div>


                <div class="atalk">
                    <div class="talkTopDiv">用户<i>2020年3月31日 16:43:15</i></div>
                    <span>告诉我一下公司地址可以吗？</span>
                </div>

                <div class="btalk">
                    <div class="talkTopDiv"><i>2020年3月31日 16:43:15</i>推荐话术</div>
                    <span>好的，请问您的公司名称是哪里？</span>
                </div>
            </div>
        </fieldset>
    </div>
</div>
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
        <button class="layui-btn layui-btn-sm" lay-event="remove">验证是否全选</button>
    </div>
</script>
<!--引入资源文件-->
<script src="../staticResourceFile/layui/layui.js"></script>
<script src="../staticResourceFile/reconnecting-websocket.js"></script>
<!--行内数据  表单元素   -->
<script id="checkboxTem" type="text/html">
    <form class="layui-form" action="">
        <div class="layui-form-item" pane="">
            <div class="layui-input-block">
                {{# layui.each(d.corpusSegmentationSet, function(index, item){ }}
                <input type="checkbox" {{ item.checked=="1"?'checked':'' }} title="{{ item.segWord }}">
                {{# }); }}
            </div>
        </div>
    </form>
</script>
<!--行级操作按钮-->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script type="text/html" id="statusTpl">
    {{#  if(d.logDtlType == 0){ }}
    <span style="color: #29303896;">坐席</span>
    {{#  } else if(d.logDtlType == 1) { }}
    <span style="color: #3d536d96;">用户</span>
    {{#  } }}
</script>
<script type="text/javascript">
    Date.prototype.format = function (format) {
        var o = {
            "M+": this.getMonth() + 1,
            "d+": this.getDate(),
            "h+": this.getHours(),
            "m+": this.getMinutes(),
            "s+": this.getSeconds(),
            "q+": Math.floor((this.getMonth() + 3) / 3),
            "S": this.getMilliseconds()
        }
        if (/(y+)/.test(format)) {
            format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        }
        for (var k in o) {
            if (new RegExp("(" + k + ")").test(format)) {
                format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
            }
        }
        return format;
    }

    //获取时间并设置格式
    function GetTime() {
        var mon, day, now, hour, min, ampm, time, str, tz, end, beg, sec;
        mon = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月",
            "九月", "十月", "十一月", "十二月"];
        day = ["周日", "周一", "周二", "周三", "周四", "周五", "周六"];
        now = new Date();
        hour = now.getHours();
        min = now.getMinutes();
        sec = now.getSeconds();
        if (hour < 10) {
            hour = "0" + hour;
        }
        if (min < 10) {
            min = "0" + min;
        }
        if (sec < 10) {
            sec = "0" + sec;
        }
        document.getElementById("timer").value =
            now.getFullYear() + "年" + (now.getMonth() + 1) + "月" + now.getDate() + "日" + "  " + hour + ":" + min + ":" + sec;
    }

    function createWebSocketPath(path) {
        var protocolPrefix = (window.location.protocol === 'https:') ? 'wss:' : 'ws:';
        return protocolPrefix + '//' + location.host + path;
    }


    layui.use(['layer', 'element', 'jquery', 'table'], function () {
        var $ = layui.jquery
            , layer = layui.layer
            , element = layui.element;
        GetTime();
        setInterval("GetTime()", 1000);
        element.on('collapse(collapseTab)', function (data) {
        });
        //建立话术辅助websocket通信
        // var vtSocketPath = createWebSocketPath('${contextPath}/verbalTrickWebsocket/${extensionNumber}')
        // var vtSocketPath = createWebSocketPath('//127.0.0.1:8080/verbalTrickWebsocket/80001')
        // var vtWs = new ReconnectingWebSocket(vtSocketPath);
        // vtWs.onopen = function () {
        //     this.data = new Date();
        //     console.info("地址：" + vtSocketPath + "的通信连接了");
        // };
        // vtWs.onmessage = function (evt) {
        //     var vtData = eval('(' + evt.data + ')');
        //     console.info(vtData);
        //     $("#callingNumber").val(vtData.callingNumber);
        //     $("#calledNumber").val(vtData.calledNumber);
        //     debugger
        //     loadContent(vtData);
        // };
        // vtWs.onclose = function (event) {
        //     console.info(event);
        //     console.info("地址：" + vtSocketPath + "的通信关闭了，持续时间：" + (new Date() - this.data));
        // };
        // vtWs.error = function (event) {
        //     layer.msg(event.data)
        // };
        //
        // /**
        //  * 加载聊天和话术辅助聊天窗口
        //  */
        // var dialogLeftDiv = $("#dialogLeft");
        // var dialogLeftDivVT = $("#dialogLeftVt");
        // //1表示坐席先说的话，没有查标准回答，前台要展示独立的一组数据
        // //2表示客户之前说过话，前台要展示一组数据，客户说的话，以及标准回答
        // //3表示坐席实际回答内容，前台要展示到标准回答的下面
        // //4：是欢迎语
        // //5：是词槽展示
        // var loadContent = function (data) {
        //     //定义空字符串
        //     var str = "";
        //     let type = data["type"];
        //     if (type === 4) {
        //         str = ' <div class="btalk">\n' +
        //             '       <div class="talkTopDiv"> <i>' + data["requestTime"] + '</i>欢迎语</div>\n' +
        //             '        <span>' + data["questionContent"] + '</span>\n' +
        //             '   </div>';
        //         dialogLeftDivVT.append(str);
        //     } else if (type === 1 || type === 3) {
        //         str = ' <div class="btalk">\n' +
        //             '       <div class="talkTopDiv"> <i>' + data["requestTime"] + '</i>坐席</div>\n' +
        //             '        <span>' + data["talkContent"] + '</span>\n' +
        //             '   </div>';
        //         dialogLeftDiv.append(str);
        //     } else if (type === 2) {
        //         str = ' <div class="atalk">\n' +
        //             '       <div class="talkTopDiv">用户<i>' + data["requestTime"] + '</i></div>\n' +
        //             '        <span>' + data["talkContent"] + '</span>\n' +
        //             '   </div>';
        //         dialogLeftDiv.append(str);
        //         dialogLeftDivVT.append(str);
        //         str = ' <div class="btalk">\n' +
        //             '       <div class="talkTopDiv"> <i>' + data["requestTime"] + '</i>推荐话术</div>\n' +
        //             '        <span>' + data["questionContent"] + '</span>\n' +
        //             '   </div>';
        //         dialogLeftDivVT.append(str);
        //     } else if (type === 5) {
        //         //词槽展示，需要思考
        //     }
        //     dialogLeftDiv.scrollTop(dialogLeftDiv[0].scrollHeight);
        //     dialogLeftDivVT.scrollTop(dialogLeftDivVT[0].scrollHeight);
        // };
        //
        //
        // window.onbeforeunload = function (event) {
        //     vtWs.close();
        // }
    })
</script>
</body>
</html>